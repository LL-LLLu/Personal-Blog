# Additional Nginx configuration for production

# Rate limiting zones (already defined in nginx.conf but can be overridden)
# limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
# limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;

# Connection limiting
# limit_conn_zone $binary_remote_addr zone=perip:10m;

# Upstream backend servers (for load balancing if needed)
# upstream backend_servers {
#     least_conn;
#     server weblog-backend-prod:8080 max_fails=3 fail_timeout=30s;
#     # Add more backend servers for load balancing
#     # server weblog-backend-2:8080 max_fails=3 fail_timeout=30s;
# }

# Cache configuration
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=100m inactive=60m use_temp_path=off;

# Custom log format
log_format json_combined escape=json
  '{'
    '"time_local":"$time_local",'
    '"remote_addr":"$remote_addr",'
    '"remote_user":"$remote_user",'
    '"request":"$request",'
    '"status": "$status",'
    '"body_bytes_sent":"$body_bytes_sent",'
    '"request_time":"$request_time",'
    '"http_referrer":"$http_referer",'
    '"http_user_agent":"$http_user_agent"'
  '}';

# You can enable this in the server block:
# access_log /var/log/nginx/access.log json_combined;